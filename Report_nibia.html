<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maria Sanchez Linares, Nibia Becerra Santillan, Emanuel Deleon Otazu">

<title>Venezuela-Colombia Relations through the News: A Topic Modeling Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Report_nibia_files/libs/clipboard/clipboard.min.js"></script>
<script src="Report_nibia_files/libs/quarto-html/quarto.js"></script>
<script src="Report_nibia_files/libs/quarto-html/popper.min.js"></script>
<script src="Report_nibia_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Report_nibia_files/libs/quarto-html/anchor.min.js"></script>
<link href="Report_nibia_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Report_nibia_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Report_nibia_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Report_nibia_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Report_nibia_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Venezuela-Colombia Relations through the News: A Topic Modeling Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Maria Sanchez Linares, Nibia Becerra Santillan, Emanuel Deleon Otazu </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This project is inspired by the intricate historical and ongoing dynamics of Venezuela-Colombia relations, particularly in the context of migration, political tensions, and economic challenges.This relationship has been shaped by significant historical events that have deeply influenced migration patterns, political tensions, and economic ties. In the 1980s, the internal conflicts in Colombia and Venezuela’s oil boom led to a massive influx of Colombians seeking refuge in Venezuela, with an estimated 4-5 million Colombian migrants. However, in the 2000s, political tensions escalated as Venezuela’s left-wing president openly supported Colombian guerrilla groups, further straining relations. The humanitarian crisis in Venezuela sparked a massive migration flow from 2017 to 2019, with millions of Venezuelans seeking refuge in Colombia. By 2022, Venezuela had the second-largest refugee crisis in the world, with approximately 7.7 million displaced people, and Colombia hosted around 2.8 million of these migrants. That same year, Colombia’s first left-wing president, Gustavo Petro, was elected and worked to re-establish diplomatic ties with Venezuela, signaling a shift in the political landscape and opening new opportunities for cooperation in addressing migration and economic challenges. This dynamic history of migration, political conflict, and economic disparity inspired my project, which aims to examine how these factors continue to shape the lives of individuals and the relationship between the two countries.</p>
<p>By focusing on a large corpus of news articles from Colombian newspapers like El Tiempo and El Espectador, the project seeks to computationally analyze how these factors have manifested in media narratives over time. The use of topic modeling, specifically Latent Dirichlet Allocation (LDA), will allow us to identify and track the key themes that have shaped the discourse around Venezuela and Colombia, providing insights into how political events, economic crises, and migration trends have influenced public perception and bilateral relations. Through this analysis, the project aims to uncover the evolving nature of their relationship and explore the role of media in framing these complex dynamics.</p>
<p><strong>Research Question:</strong></p>
<p><em>What are the main themes discussed in Colombian newspapers about Venezuela-Colombia relations and how do they change in response to significant historical/political events?</em></p>
<p><strong>Data Source:</strong></p>
<p>The data for this analysis consists of newspaper articles from El Tiempo and El Espectador, covering the years 2017, 2020, and 2023.</p>
</section>
<section id="data-and-methodology" class="level2">
<h2 class="anchored" data-anchor-id="data-and-methodology">Data and Methodology</h2>
<p><strong>Data Collection and Preprocessing:</strong></p>
<ol type="1">
<li><strong>Data Extraction:</strong> Articles were extracted from PDF files using <code>pdftools</code> and other relevant libraries.</li>
<li><strong>Text Cleaning:</strong> Text was cleaned by removing stop words, punctuation, and special characters.</li>
<li><strong>Tokenization:</strong> Text was tokenized into individual words.</li>
<li><strong>Lemmatization:</strong> Words were lemmatized to their root forms using a Spanish lemmatizer.</li>
</ol>
<p><strong>Topic Modeling:</strong></p>
<section id="topic-modeling" class="level3">
<h3 class="anchored" data-anchor-id="topic-modeling">Topic Modeling</h3>
<ol type="1">
<li><p><strong>Document-Term Matrix (DTM):</strong> A Document-Term Matrix (DTM) was created to represent the occurrence of words in each document. The DTM is a matrix where rows represent documents and columns represent unique words from the corpus.</p></li>
<li><p><strong>Optimal Number of Topics:</strong> We used model fitness scores to validate the optimal number of topics for LDA. Specifically, the <code>FindTopicNumber()</code> function from the <code>ldatuning</code> package was applied. This function allows for the input of multiple values for the number of topics (k) and calculates four different model fitness scores simultaneously: Griffiths2004, Deveaud2014, CaoJuan2009, and Arun2010. The use of multiple fitness scores provided a comprehensive approach to determining the optimal number of topics for the LDA model.</p></li>
</ol>
<ul>
<li><p>Griffiths2004: Aims to identify coherence.</p></li>
<li><p>Deveaud2014: Reflects interpretability.</p></li>
<li><p>CaoJuan2009: Measures distinctiveness.</p></li>
<li><p>Arun2010: Analyzes topic separation.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="general_fitness_scores.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1. Line Graphs Showing Four Model Fitness Scores of k Topics</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li><p><strong>LDA Model:</strong> A Latent Dirichlet Allocation (LDA) model was fitted to the DTM to identify latent topics. LDA is a probabilistic model that discovers topics by analyzing patterns of word co-occurrence across documents. Each topic is characterized by a set of words that frequently appear together, and each document is a mixture of these topics. LDA assigns a topic to each document based on the probability of word co-occurrence.</p></li>
<li><p><strong>Topic Interpretation and Refinement:</strong> After identifying the latent topics, in consultation with Prof.&nbsp;Busse-Cárdenas, additional analysis was performed to ensure that meaningful themes emerged from the model. The identified topics were interpreted by examining the most frequent words associated with each topic in the context of Venezuela-Colombia relations.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#terms(lda_model, 20)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li><strong>Time-Series Analysis:</strong> To observe how the prominence of different topics evolved over time, a time-series analysis was conducted. This involved tracking the load of topics across different time periods, based on the frequency with which words associated with each topic appeared in the articles. Each document was assigned to the topic with the highest probability <em>gamma value</em> and the number and percentage of articles corresponding to each topic were tracked annually. This approach, similar to methods used by Roh and Yang (2019), helped identify shifts in public discourse and media representation over time, especially in relation to key political, economic, and migration-related events.</li>
</ol>
</section>
</section>
<section id="results-and-discussion" class="level2">
<h2 class="anchored" data-anchor-id="results-and-discussion">Results and Discussion</h2>
<p><strong>General Topic Identification and Interpretation: 1st LDA</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Topic 1</strong></th>
<th><strong>Topic 2</strong></th>
<th><strong>Topic 3</strong></th>
<th><strong>Topic 4</strong></th>
<th><strong>Topic 5</strong></th>
<th><strong>Topic 6</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>años (years), colombia (Colombia), vida (life), ser (to be), tiempo (time), solo (only), cómo (how), hace (does), día (day), así (so), persona (person), gente (people), vez (time), historia (history), país (country), hacer (to do), mundo (world), bogotá (Bogotá), cada (each), después (after)</td>
<td>presidente (president), petro (Petro), venezuela (Venezuela), gobierno (government), maduro (Maduro), colombia (Colombia), dijo (said), oposición (opposition), nicolás (Nicolás), país (country), elecciones (elections), nacional (national), gustavo (Gustavo), política (politics), guaidó (Guaidó), campaña (campaign), benedetti (Benedetti), electoral (electoral), político (political), tiempo (time)</td>
<td>venezuela (Venezuela), eln (ELN), colombia (Colombia), paz (peace), fiscalía (prosecutor’s office), gobierno (government), según (according to), grupo (group), policía (police), justicia (justice), farc (FARC), autoridades (authorities), persona (person), general (general), país (country), caso (case), unidos (United States), corte (court), dijo (said), fiscal (prosecutor)</td>
<td>colombia (Colombia), brasil (Brazil), argentina (Argentina), américa (America), selección (selection), venezuela (Venezuela), equipo (team), tiempo (time), chile (Chile), grupo (group), partido (party), mundial (world), ecuador (Ecuador), uruguay (Uruguay), perú (Peru), gda (GDA), fútbol (soccer), diarios (newspapers), copyright (copyright), reservados (reserved)</td>
<td>colombia (Colombia), persona (person), país (country), migrantes (migrants), venezuela (Venezuela), venezolanos (Venezuelans), ciento (percent), salud (health), según (according to), frontera (border), migración (migration), países (countries), millones (millions), año (year), coronavirus (coronavirus), población (population), casos (cases), unidos (United States), situación (situation), merlano (Merlano)</td>
<td>colombia (Colombia), países (countries), país (country), venezuela (Venezuela), unidos (United States), gobierno (government), américa (America), política (politics), región (region), presidente (president), puede (can), internacional (international), ser (to be), mundo (world), trump (Trump), años (years), parte (part), biden (Bide</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Inter-Topic Distance:</strong> The relationships between topics were visualized using an inter-topic distance map.</p></li>
<li><p><strong>Top Terms and Themes:</strong> “Soccer”, “Venezuelan Politics”, “Colombia-Venezuela Diplomacy”, “Migration”, “Environmental Degradation”, “Guerrilla”</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Key_GeneralThemes.png" class="img-fluid figure-img" width="300"></p>
<figcaption>Key General Themes</figcaption>
</figure>
</div>
<p>This bar graph displays the number of papers assigned to each topic across the years 2017, 2020, and 2023. The topics include Colombia-Venezuela Diplomacy, Guerrilla, Soccer, Environmental Degradation, Migration, and Venezuelan Politics. The height of each bar represents the count of papers discussing a specific topic in a given year. Brief Analysis</p>
<p>Overall, there are more articles published in 2023 compared to 2017 and 2020, leading to a general increase across all topics. However, the proportions of topics have shifted over time. For example, topics like Colombia-Venezuela Diplomacy and Guerrilla showed significant increases in 2023, while Environmental Degradation and Venezuelan Politics remained more stable relative to other topics. This indicates a growing emphasis on international relations and conflict in the later years.</p>
<p><strong>Topic Identification and Interpretation within “Migration: 2nd LDA</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Topic 1</strong></th>
<th><strong>Topic 2</strong></th>
<th><strong>Topic 3</strong></th>
<th><strong>Topic 4</strong></th>
<th><strong>Topic 5</strong></th>
<th><strong>Topic 6</strong></th>
<th><strong>Topic 7</strong></th>
<th><strong>Topic 8</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>israel, gaza, hamás, mundo, guerra, presidente, persona, franja, palestino, unidos, dijo, según, israelíes, conflicto, noticias, gobierno, palestinos, ataque, país, israelí</td>
<td>venezolanos, persona, migrantes, autoridades, ciudad, país, dijo, según, frontera, años, policía, grupo, gobierno, colombia, tiempo, centro, crisis, venezolano, zona, derechos</td>
<td>migrantes, persona, darién, migración, dijo, selva, colombia, dólares, panamá, unidos, día, frontera, años, llegar, días, ruta, solo, año, cada, hacia</td>
<td>colombia, venezolanos, migrantes, migración, país, población, persona, frontera, gobierno, millones, situación, venezolana, países, crisis, migratoria, colombianos, cúcuta, migrante, según, internacional</td>
<td>coronavirus, salud, país, casos, covid, pandemia, colombia, persona, gobierno, medidas, virus, países, cuarentena, presidente, días, brasil, caso, autoridades, emergencia, según</td>
<td>bogotá, aire, ciudad, calidad, colombia, salud, puede, nacional, pasaporte, san, guajira, capital, alerta, secretaría, país, condiciones, según, debe, cuenta, estudiantes</td>
<td>persona, mujeres, derechos, colombia, violencia, años, niños, país, salud, casos, situación, población, humanos, informe, niñas, ser, víctimas, parte, solo, año</td>
<td>unidos, colombia, méxico, migrantes, persona, países, país, frontera, colombianos, asilo, visa, año, gobierno, título, biden, migración, américa, según, tiempo, derechos</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Top Terms and Themes:</strong> “Gaza”, “Colombia-Venezuelan Border Security”, “Darien Migration Route”, “Venezuela Migration Crisis”, “COVID-19”, “Health”, “Migrant Human Trafficking”, “Venezuelan Migrants-US”</li>
</ul>
<p>The bar graph illustrates the distribution of papers assigned to each topic across three years: 2017, 2020, and 2023. Topics include Colombia-Venezuelan Border Security, the Darien Migration Route, COVID-19, Health, Gaza, Migrant Human Trafficking, Venezuelan Migration Crisis, and Venezuelan Migrants to the United States. Each bar’s height represents the number of papers discussing a specific topic in a given year. The graph highlights shifting focus over time, with COVID-19 dominating coverage in 2020 and a significant increase in articles related to Venezuelan Migrants to the US in 2023. Meanwhile, topics like the Darien Migration Route and Migrant Human Trafficking gained more attention in 2023 compared to earlier years, reflecting the evolving priorities in migration-related reporting. “Gaza” and “Venezuelan Migrants to the US” are topics that gained relevance in 2023. However, there are some articles in previous years</p>
<p><strong>Topic Evolution Over Time:</strong></p>
<ul>
<li><strong>Topic Distribution:</strong> The distribution of topics across different years was analyzed to identify trends and shifts.</li>
<li><strong>Time Series Analysis:</strong> Time series analysis was used to track the evolution of topics over time.</li>
</ul>
<p><strong>Document-Level Analysis:</strong></p>
<ul>
<li><strong>Topic Assignments:</strong> Documents were assigned to topics based on their content.</li>
<li><strong>Representative Documents:</strong> The most representative documents for each topic were identified and analyzed.</li>
</ul>
<p><strong>Comparative Analysis:</strong></p>
<ul>
<li><strong>Newspaper Comparison:</strong> The dominant topics in El Tiempo and El Espectador were compared to identify differences and similarities.</li>
</ul>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>[Summarize the key findings and their implications. Discuss the limitations of the study and potential future research directions.]</p>
</section>
<section id="appendix-optional" class="level2">
<h2 class="anchored" data-anchor-id="appendix-optional">Appendix (Optional)</h2>
<ul>
<li><strong>Code Snippets:</strong> Include relevant R code snippets for data cleaning, preprocessing, topic modeling, and visualization.</li>
<li><strong>Additional Visualizations:</strong> Provide additional visualizations, such as word clouds, bar charts, and network diagrams.</li>
<li><strong>Technical Details:</strong> Discuss specific implementation details, such as hyperparameter tuning and model evaluation metrics.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>